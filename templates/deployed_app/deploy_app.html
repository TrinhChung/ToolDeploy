{% extends "base.html" %}
{% block title %}Deploy App{% endblock %}

{% block content %}
<div class="container py-4">
	<h2 class="mb-4"><i class="fa fa-plus text-primary me-2"></i>Deploy App Mới</h2>
	<form method="POST" id="deployAppForm" novalidate>
		{{ form.hidden_tag() }}
		<div class="row g-3 mb-3">
			<div class="col-md-6">
				{{ form.server_id.label(class="form-label") }}
				{{ form.server_id(class="form-select") }}
			</div>
			<div class="col-md-6">
				{{ form.domain_id.label(class="form-label") }}
				{{ form.domain_id(class="form-select") }}
			</div>
			<div class="col-md-6">
				{{ form.subdomain.label(class="form-label") }}<span class="text-danger ms-1">*</span>
				{{ form.subdomain(class="form-control", required=True, placeholder="Nhập subdomain (không nhập @)") }}
				<small class="form-text text-muted">Subdomain là bắt buộc. Không nhập @ hoặc để trống.</small>
				<div class="invalid-feedback" id="subdomainError"></div>
			</div>
			<div class="col-md-6">
				{{ form.note.label(class="form-label") }}
				{{ form.note(class="form-control", placeholder="Ghi chú (tuỳ chọn)") }}
			</div>
		</div>

		<div class="card shadow-sm border mb-4">
			<div class="card-body">
				<h5 class="mb-3"><i class="fa fa-cogs me-2"></i>Cấu hình ENV cho App</h5>
				<div class="row g-3">
					<div class="col-md-4">
						{{ form.APP_ID.label(class="form-label") }}
						{{ form.APP_ID(class="form-control") }}
					</div>
					<div class="col-md-4">
						{{ form.APP_NAME.label(class="form-label") }}
						{{ form.APP_NAME(class="form-control") }}
					</div>
					<div class="col-md-4">
						{{ form.EMAIL.label(class="form-label") }}
						{{ form.EMAIL(class="form-control") }}
					</div>
					<div class="col-md-6">
						{{ form.ADDRESS.label(class="form-label") }}
						{{ form.ADDRESS(class="form-control") }}
					</div>
					<div class="col-md-6">
						{{ form.PHONE_NUMBER.label(class="form-label") }}
						{{ form.PHONE_NUMBER(class="form-control") }}
					</div>
					<div class="col-md-6">
						{{ form.DNS_WEB.label(class="form-label") }}
						{{ form.DNS_WEB(class="form-control") }}
					</div>
					<div class="col-md-6">
						{{ form.COMPANY_NAME.label(class="form-label") }}
						{{ form.COMPANY_NAME(class="form-control") }}
					</div>
					<div class="col-md-6">
						{{ form.TAX_NUMBER.label(class="form-label") }}
						{{ form.TAX_NUMBER(class="form-control") }}
					</div>
				</div>
			</div>
		</div>

		<div class="d-flex gap-2 mt-3">
			<button type="submit" class="btn btn-success px-4">
				<i class="fa fa-paper-plane me-2"></i>Deploy App
			</button>
			<button name="default_env" value="1" class="btn btn-outline-secondary" type="submit">
				<i class="fa fa-magic me-1"></i>Đề giá trị mặc định
			</button>
		</div>
	</form>
</div>

<script>
	document.getElementById('deployAppForm').addEventListener('submit', function (e) {
		const subdomain = document.querySelector('input[name="subdomain"]');
		const err = document.getElementById('subdomainError');
		if (subdomain.value.trim() === "" || subdomain.value.includes('@')) {
			e.preventDefault();
			err.textContent = "Không được để trống và không nhập @ ở subdomain!";
			subdomain.classList.add('is-invalid');
			subdomain.focus();
			return false;
		} else {
			subdomain.classList.remove('is-invalid');
			err.textContent = "";
		}
	});
</script>
<style>
	.card-body {
		background: #f8fafc;
	}

	.form-label {
		font-weight: 500;
	}

	.btn-success {
		min-width: 140px;
	}

	.btn-outline-secondary {
		min-width: 170px;
	}
</style>
{% endblock %}